Pesapal API 3.0
Welcome to Pesapal API 3.0. Getting started with Pesapal is quick and easy!

In this release, you will learn how to use our API endpoints to access Pesapal services. Our APIs are built on REST(Representational State Transfer) thus our data entities are represented as HTTP resources and are accessed using HTTP verbs GET and POST. Requests and responses are JSON encoded.

Find information about integrating your website with Pesapal. This documentation includes sample codes for each API we have.

Postman URL: https://documenter.getpostman.com/view/6715320/UyxepTv1

Base URLs
Environment	URL
Sandbox	https://cybqa.pesapal.com/pesapalv3
Live	https://pay.pesapal.com/v3
Error Object
In case an error occurs during any API call, Pesapal will respond with a json string in the following format : -

1
{
2
    "error": {
3
        "type": "error_type",
4
        "code": "response_code",
5
        "message": "Detailed error message goes here.."
6
    }
7
}


Authentication Endpoint - Post Request
Pesapal's API Authentication requests are done via a POST request.

Your Pesapal merchant consumer_key and consumer_secret will be used to generate an access token.

This access token is valid for a maximum period of 5 minutes. Use this token (sent as a Bearer Token) to access all other Pesapal API 3.0 endpoints.

The URL to our token generation API is either:

Sandbox/Demo URL: https://cybqa.pesapal.com/pesapalv3/api/Auth/RequestToken
Production/Live URL: https://pay.pesapal.com/v3/api/Auth/RequestToken
HTTP request headers
Accept: The response format, which is required for operations with a response body.
Content-Type: The request format, which is required for operations with a request body.

Parameter	Required	Description
Accept	Required	Should be set to application/json
Content-Type	Required	Should be set to application/json

Request Parameters
Your live/production consumer_key and consumer_secret will be sent to your merchant email on opening a business/merchant account.

Please click here to open a live/production business account.

Click here to download test credentials to use while connecting to our demo/sandbox API.
Parameter	Type	Required	Description
consumer_key	String	Required	The consumer_key parameter must be set to merchant consumer_key
consumer_secret	String	Required	The consumer_secret parameter must be set to merchant consumer_secret.

Sample Request
1
{
2
    "consumer_key": "xxxxx",
3
    "consumer_secret": "xxxxxx"
4
}

Response Parameters

Name	Type	Description
token	String	The access token string as issued by the server. The access token issued will have permission to invoke all Pesapa API operations.
expiryDate	String	Date and time the token will expire. The access token usually expires after 5mins - UTC
error	Object	Error object
status	String	Response code
message	String	A brief description about the response received.

Sample Response
view sourceprint?
1
{
2
    "token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYa",
3
    "expiryDate": "2021-08-26T12:29:30.5177702Z",
4
    "error": null,
5
    "status": "200",
6
    "message": "Request processed successfully"
7
}   

IPN URL Registration Endpoint - Post Request
IPN stands for Instant Payment Notification. When a payment is made against a transaction, Pesapal will trigger an IPN call to the notification URL related to this transaction. This notification URL is usually located on your servers. These notifications allows you to be alerted in real time whenever there is a status change for any transaction.

An IPN is particular important as it allows you to be notified incase the following happens:

Your client gets disconnected after payment due to internet issues
Your client experiences server errors hence Pesapal and your application gets disconnected before callback URL is loaded.
Your client exits your application / closes the browser during payment.
The transaction is rejected.
As such, it's mandatory to have IPN configured to allow Pesapal to notify your servers when a status changes. It's also important to note that this IPN URL must be publicly available. In cases where you have strict server rules preventing external systems reaching your end, you must then whitelist all calls from our domain (pesapal.com). Please be informed that IP whitelisting is not feasible as our IP may change without notice.

Before sending Submit Order Requests to Pesapal API 3.0, you are expected to register your IPN URL. Upon registration, you receive an IPN ID which is a mandatory field (notification_id) when submitting an order request to Pesapal API 3.0. This notification_id uniquely identifies the endpoint Pesapal will send alerts to whenever a payment status changes for each transaction processed via API 3.0

The URL to our IPN registration API is either:

Sandbox/Demo URL: https://cybqa.pesapal.com/pesapalv3/api/URLSetup/RegisterIPN
Production/Live URL: https://pay.pesapal.com/v3/api/URLSetup/RegisterIPN
Authentication
Bearer Token : Use token generated during authentication.

HTTP request headers
Accept: The response format, which is required for operations with a response body.
Content-Type: The request format, which is required for operations with a request body.

Parameter	Required	Description
Accept	Required	Should be set to application/json
Content-Type	Required	Should be set to application/json

Request Parameters

Parameter	Type	Required	Description
url	String	Required	The notification url Pesapal with send a status alert to.
ipn_notification_type	String	Required	GET or POST. This is the http request method Pesapal will use when triggering the IPN alert.

Sample Request
1
{
2
    "url": "https://www.myapplication.com/ipn",
3
    "ipn_notification_type": "GET"
4
}

Response Parameters
Name	Description
url	The notification url Pesapal will send a status alert to.
created_date	Date and time the IPN URL was registered UTC
ipn_id	A unique identifier that's linked to the IPN endpoint URL. GUID
notification_type	1 or 0
ipn_notification_type_description	The http request method you registered your IPN url as
ipn_status	1 or 0 ie Active or Inactive
ipn_status_decription	Status description ie Active or Inactive
error	An error object containing error_type, code and message if any. Null to signify no error.
status	Response code.

Sample Response
01
{
02
    "url": "https://myapplication.com/ipn",
03
    "created_date": "2024-06-14T07:50:22.2825997Z",
04
    "ipn_id": "84740ab4-3cd9-47da-8a4f-dd1db53494b5",
05
    "notification_type": 0,
06
    "ipn_notification_type_description": "GET",
07
    "ipn_status": 1,
08
    "ipn_status_description": "Active",
09
    "error": null,
10
    "status": "200"
11
}

You can also use our online forms below to register your IPN URLs.

- Sandbox/Demo IPN Registration Form
- Production/Live IPN Registration Form

Get Registered IPNs Endpoint - Get Request
This endpoint allows you to fetch all registered IPN URLs for a particular Pesapal merchant account.

The URL to our GetIPNList API is either:

Sandbox/Demo URL: https://cybqa.pesapal.com/pesapalv3/api/URLSetup/GetIpnList
Production/Live URL: https://pay.pesapal.com/v3/api/URLSetup/GetIpnList
Authentication
Bearer Token : Use token generated during authentication.

Request
No payload is required.

Response Parameters

Name	Type	Description
url	String	The notification url Pesapal with send a status alert to.
created_date	String	Date and time the IPN URL was registered UTC
ipn_id	String	A unique identifier that's liked to the IPN endpoint URL. GUID
error	Integer	
status	String	Response code.

Sample Response
view sourceprint?
01
[
02
    {
03
        "url": "https://www.myapplication.com/ipn",
04
        "created_date": "2022-03-03T17:29:03.7208266Z",
05
        "ipn_id": "e32182ca-0983-4fa0-91bc-c3bb813ba750",
06
        "error": null,
07
        "status": "200"
08
    },
09
    {
10
        "url": "https://ipn.myapplication.com/application2",
11
        "created_date": "2021-12-05T04:23:45.5509243Z",
12
        "ipn_id": "c3bb813ba750-0983-4fa0-91bc-e32182ca",
13
        "error": null,
14
        "status": "200"
15
    }
16
]

Submit Order Request Endpoint - Post Request
Once you have received the bearer token, the next step will be the actual request to create a payment request.

A good example would be a case where the customer has clicked pay now button on your website. At this point, you call the SubmitOrderRequest and in return you will get a response which contains a payment redirect URL which you then redirect the customer to or load the URL as an iframe within your site in case you don’t want to redirect the customer off your application.

The payment URL will contain the payment methods presented to the customer by Pesapal. After the customer has made the payment, they will be redirected to your callback URL which you will have already provided to us as part of submit order request.

The URL to our SubmitOrderRequest API is either:

Sandbox/Demo URL: https://cybqa.pesapal.com/pesapalv3/api/Transactions/SubmitOrderRequest
Production/Live URL: https://pay.pesapal.com/v3/api/Transactions/SubmitOrderRequest
Authentication
Bearer Token : Use token generated during authentication.

HTTP request headers
Accept: The response format, which is required for operations with a response body.
Content-Type: The request format, which is required for operations with a request body.

Parameter	Required	Description
Accept	Required	Should be set to application/json
Content-Type	Required	Should be set to application/json

Request Parameters

Parameter	Type	Required	Description
id	String	Required	This refers to your unique merchant reference generated by your system. NOTE: It should be unique at all times for every order request. Maximum - 50 characters
currency	String	Required	This represents the currency you want to charge your customers. ISO Currency Codes
amount	Float	Required	Amount to be processed.
description	String	Required	Represents the description of your order. Maximum - 100 characters
redirect_mode	String	Optional	Accepts values TOP_WINDOW or PARENT_WINDOW.
If left blank, the default value used will be TOP_WINDOW.

This parameter allows you to define where your callback URL will be loaded;
- TOP_WINDOW returns to the topmost window in the hierarchy of windows.
- PARENT_WINDOW returns the immediate parent of a window.
callback_url	String	Required	A valid URL which Pesapal will redirect your clients to processing the payment.
cancellation_url	String	Optional	A valid URL which Pesapal will redirect your clients to incase they click on cancel request while on the Payment link.

If provided, a cancellation link will appear next to the PROCEED button.
notification_id	Guid	Required	This represents an IPN URL which Pesapal will send notifications to after payments have been processed.

You are required to register all IPN URLs after which a corresponding notification_id will be generated. Please refer to the IPN URL registration endpoint.
branch	String	Optional	If your business has multiple stores / branches, you can define the name of the store / branch to which this particular payment will be accredited to.
billing_address	Object	Required	Customer Address Object
Customer Address Object

Name	Type	Required	Description
phone_number	String	Optional if email address is provided.
Mandatory if email address is NOT provided.	Customer's phone number
email_address	String	Optional if phone number is provided.
Mandatory if phone number is NOT provided.	Customer's email address
country_code	String	Optional	2 characters long country code in [ISO 3166-1](https://en.wikipedia.org/wiki/ISO_3166-1)
first_name	String	Optional	Customer's first name
middle_name	String	Optional	Customer's middle name
last_name	String	Optional	Customer's last name
line_1	String	Optional	Customer's main address
line_2	String	Optional	Customer's alternative address
city	String	Optional	Customer's city
state	String	Optional	Customer's state Maximum - 3 characters
postal_code	Integer	Optional	Customer's postal code
zip_code	Integer	Optional	Customer's zip code

Sample Request
01
{
02
    "id": "AA1122-3344ZZ",
03
    "currency": "KES",
04
    "amount": 100.00,
05
    "description": "Payment description goes here",
06
    "callback_url": "https://www.myapplication.com/response-page",
07
    "redirect_mode": "",
08
    "notification_id": "fe078e53-78da-4a83-aa89-e7ded5c456e6",
09
    "branch": "Store Name - HQ",
10
    "billing_address": {
11
        "email_address": "john.doe@example.com",
12
        "phone_number": "0723xxxxxx",
13
        "country_code": "KE",
14
        "first_name": "John",
15
        "middle_name": "",
16
        "last_name": "Doe",
17
        "line_1": "Pesapal Limited",
18
        "line_2": "",
19
        "city": "",
20
        "state": "",
21
        "postal_code": "",
22
        "zip_code": ""
23
    }
24
}   

After successfully creating the order, your response will contain a payment URL (redirect_url).

Status 200 mean your request to process the payment has been received successfully meaning the order has been successfully created on our systems and you can now redirect your customer to make the payment.

Response Parameters

Name	Type	Description
order_tracking_id	String	Unique order id generated by Pesapal.
merchant_reference	String	Your application's unique ID received as part of the SUBMIT ORDER REQUEST.
redirect_url	String	URL generated that contains the payment instructions. Redirect to this URL or load it within an iframe
error	Integer	
message	String	Response message.

Sample Response
1
{
2
    "order_tracking_id": "b945e4af-80a5-4ec1-8706-e03f8332fb04",
3
    "merchant_reference": "TEST1515111119",
4
    "redirect_url": "https://cybqa.pesapal.com/pesapaliframe/PesapalIframe3/Index/?OrderTrackingId=b945e4af-80a5-4ec1-8706-e03f8332fb04",
5
    "error": null,
6
    "status": "200"
7
}
Redirecting your customer to this redirect_url will present them with a list of available payment methods which they can use to make the payment.

You can either load this URL outside or within your website (using an Iframe). The advantage of using an iframe is that your customer will not be redirected off the site, hence a seamless payment process.

Once your customer selects their preferred payment method and makes a payment, Pesapal will process the payment and redirect your customers to the callback URL which you had provided as part of the SubmitOrderRequest API call.

Callback Details
The following parameter will be appended to your callback URL.

Parameter	Type	Description
OrderTrackingId	String	Unique order id generated by Pesapal.
OrderNotificationType	String	Has value CALLBACKURL to represent a callback request
OrderMerchantReference	String	Your application's unique ID received as part of the SUBMIT ORDER REQUEST.

Sample Callback URL: https://www.myapplication.com/response-page?OrderTrackingId=b945e4af-80a5-4ec1-8706-e03f8332fb04&OrderMerchantReference=TEST1515111119&OrderNotificationType=CALLBACKURL

IPN Details
At the same time, Pesapal will send an alert to your IPN URL informing you of a status change.

The IPN alert will either be a GET or POST request, depending on which HTTP method you selected when registering the IPN URL.

The IPN call will have the following parameters;

Parameter	Type	Description
OrderTrackingId	String	Unique order id generated by Pesapal.
OrderNotificationType	String	Has value IPNCHANGE to represent an IPN call.
OrderMerchantReference	String	Your application's unique ID received as part of the SUBMIT ORDER REQUEST.
Sample GET URL
https://www.myapplication.com/response-page?OrderTrackingId=b945e4af-80a5-4ec1-8706-e03f8332fb04&OrderMerchantReference=TEST1515111119&OrderNotificationType=IPNCHANGE

Sample POST data
1
{
2
    "OrderNotificationType":"IPNCHANGE",
3
    "OrderTrackingId":"b945e4af-80a5-4ec1-8706-e03f8332fb04",
4
    "OrderMerchantReference":"TEST1515111119"
5
}
The callback URL and the IPN calls will NOT have the status of the payment for security reasons. As such, you will be required to fetch the status of the payment using the GetTransactionStatus API once the callback page is loaded and when the IPN URL is triggered.

Get Transaction Status Endpoint - Get Request
Once Pesapal redirect your customer to your callback URL and triggers your IPN URL, you need to check the status of the payment using the OrderTrackingId.

The URL to our GetTransactionStatus API is either:

Sandbox/Demo URL: https://cybqa.pesapal.com/pesapalv3/api/Transactions/GetTransactionStatus?orderTrackingId=xxxxxxxxxxxx
Production/Live URL: https://pay.pesapal.com/v3/api/Transactions/GetTransactionStatus?orderTrackingId=xxxxxxxxxxxx
Where xxxxxxxxxxxx represents the OrderTrackingId received as part of the callback [GET] or IPN [POST/GET] params.

Authentication
Bearer Token : Use token generated during authentication.

HTTP request headers
Accept: The response format, which is required for operations with a response body.
Content-Type: The request format, which is required for operations with a request body.

Parameter	Required	Description
Accept	Required	Should be set to application/json
Content-Type	Required	Should be set to application/json

Request Parameters

Parameter	type	Required	Description
orderTrackingId	string	Required	Unique order id generated by Pesapal e.g 7e6b62d9-883e-440f-a63e-e1105bbfadc3. Attached as a query parameter to the getTransactionStatus endpoint to get status of your submitted order.
Response Parameters

Name	Description
payment_method	This refers to the payment method used by your customers to make payment. Can be through CARD, MPESA, MTN, TIGO etc.
amount	Amount paid by the customer.
created_date	Date the payment was made.
confirmation_code	Confirmation code received from the payment provider used.
payment_status_description	Contains the status of the transaction. This will include either INVALID, FAILED, COMPLETED or REVERSED.
description	Description of the payment status.
message	The message shows if transaction request status was processed successfully or not.
payment_account	Masked card number or phone number used during payment.
call_back_url	A valid URL which Pesapal will redirect the client to after payment is made.
status_code	Pesapal status code representing the payment_status_description.
0 - INVALID
1 - COMPLETED
2 - FAILED
3 - REVERSED
merchant_reference	Your application's unique ID as received in the SubmitOrderRequest call.
currency	Currency the payment was made in. ISO Currency Codes.
error	An error object containing error_type, code, message and call_back_url.
status	HTTP status code as defined on RFC 2616. A status of 200 means the request was successful.

Sample Response
01
{
02
    "payment_method": "Visa",
03
    "amount": 100,
04
    "created_date": "2022-04-30T07:41:09.763",
05
    "confirmation_code": "6513008693186320103009",
06
    "payment_status_description": "Failed",
07
    "description": "Unable to Authorize Transaction.Kindly contact your bank for assistance",
08
    "message": "Request processed successfully",
09
    "payment_account": "476173**0010",
10
    "call_back_url": "https://test.com/?OrderTrackingId=7e6b62d9-883e-440f-a63e-e1105bbfadc3&OrderMerchantReference=1515111111",
11
    "status_code": 2,
12
    "merchant_reference": "1515111111",
13
    "payment_status_code": "",
14
    "currency": "KES",
15
    "error": {
16
        "error_type": null,
17
        "code": null,
18
        "message": null,
19
        "call_back_url": null
20
    },
21
    "status": "200"
22
}   

What Next?
Once you've received the payment details, you are then required to store the same in your system and provide services / services paid for.

Your IPN endpoint should then respond to Pesapal with a json string confirming receipt of the IPN call. Part of the json string contains a status parameter that should be set as 200 (meaning request was received and processed) or 500 (meaning IPN request was received but there was an issue completing the process).

Sample IPN JSON Response String: {"orderNotificationType":"IPNCHANGE","orderTrackingId":"d0fa69d6-f3cd-433b-858e-df86555b86c8","orderMerchantReference":"1515111111","status":200}

NB: Your callback page should not implement a json response. Instead, redirect the customer to a page on your system showing the payment details.


Recurring / Subscription Based Payments
Definitions
Recurring payment is a payment model where customers authorize the business to pull funds from their accounts automatically at regular intervals for the goods and services provided to them on an ongoing basis.

With Pesapal's subscription based payments, customers can set automated card payments on their account where they can be debited automatically at a different set times. Examples of services one can enroll to include cable bills, cell phone bills, gym membership fees, utility bills and magazine subscriptions. These payments can be set to run an various intervals such as daily, weekly, monthly or yearly.

How can recurring payments benefit your business?
Saves customers time: Customers no longer have to go through the payment process every time they need to make a payment.
Ensures prompt payment: Businesses no longer need to worry about getting paid on time. Since the payments are automated, they no longer need to send out overdue payment reminders.
Boosts customer loyalty: With a subscription model, businesses can form closer relationships with their customers.
Cash flow prediction: Businesses can easily predict their cash flow, which helps with business strategy.
Lowers billing and collection costs: Businesses no longer need to chase after missed payments, freeing up their time to concentrate on other elements of the business.
How do i enable recurring payment for my customers?
Enable our subscription based payments by passing an additional account_number field when sending data to our SubmitOrderRequest endpoint. This account_number should relate to an account number / invoice number that helps you identify the payment.

Note: It's critical that you get to understand all other Pesapal API 3.0 endpoints before implementing the recurring feature. Click here to get started.

In adition to the SubmitOrderRequest parameters, include one more param as show below.

Parameter	Required	Description
account_number	Optional	Customer's identification number know to your system. This can be an invoice number or an account number.

Sample Request
01
{
02
    "id": "AA1122-3344ZZ",
03
    "currency": "KES",
04
    "amount": 100.00,
05
    "description": "Payment description goes here",
06
    "callback_url": "https://www.myapplication.com/response-page",
07
    "notification_id": "fe078e53-78da-4a83-aa89-e7ded5c456e6",
08
    "billing_address": {
09
        "email_address": "john.doe@example.com",
10
        "phone_number": "0723xxxxxx",
11
        "country_code": "KE",
12
        "first_name": "John",
13
        "middle_name": "",
14
        "last_name": "Doe",
15
        "line_1": "Pesapal Limited",
16
        "line_2": "",
17
        "city": "",
18
        "state": "",
19
        "postal_code": "",
20
        "zip_code": ""
21
    },
22
    "account_number": "555-678"
23
}   
After successfully processing your request using the SubmitOrderRequest endpoint, the customer will be shown an option to opt into the recurring model on the Pesapal iframe during payment. The customer will then configure the frequency (Daily, weekly, monthly, quarterly or yearly), set a start and enddate, and finally enter an amount to be automatically deducted from their card on each payment cycle.

Pesapal Recurring Form
Once the customer has made a successful payment, Pesapal will automatically create a scheduled subscription on their behalf and an email alert will be sent to the provided card billing email that was used during the payment proccess, notifying them of the newly created subscription together with a link they can access a dashboard to manage their subscription.

Pesapal will NOT store the customer's card details. Instead, Pesapal has implemented the card tokenization technology.

Credit card tokenization is the process of de-identifying sensitive cardholder data by converting it to a string of randomly generated numbers called a "token." Similar to encryption, tokenization obfuscates the original data to render it unreadable to a user. Unlike encryption, however, credit card tokenization is irreversible.

Is it possible to send the extra subscription parameters (Frequency, amount, period) via the API?
Yes, in cases where your application already handles the process where the customer opts into a subscription based model from your application, Pesapal allows your to send these extra parameters via the API. This ensures that the user does not have to fill in the same details again (on your application and on the Pesapal Iframe).

However, it's important to note that the customer MUST accept to enroll to your subscription on the iframe. They will however not be able to edit the subscription details on the iframe.


In adition to the account_number parameter included in the SubmitOrderRequest, you are required to send the following parameter.

Parameter	Required	Description
subscription_details	Optional	Customer Subscription Object You can pass subscription data to Pesapal allowing a user to setup recurring payment..
Subscription Object

Name	Type	Required	Description
start_date	String	Mandatory	Your subscription's start date in the format dd-MM-yyyy e.g 24-01-2023 representing 24th Jan 2023
end_date	String	Mandatory	Your subscription's end date in the format dd-MM-yyyy e.g 31-12-2023 represeting 31st Dec 2023
frequency	String	Mandatory	The period billed to the account is set out in the user contract. For instance, if users subscribe to a monthly service. Accepted values include DAILY, WEEKLY, MONTHLY or YEARLY

Sample Request
01
{
02
    "id": "AA1122-3344ZZ",
03
    "currency": "KES",
04
    "amount": 100.00,
05
    "description": "Payment description goes here",
06
    "callback_url": "https://www.myapplication.com/response-page",
07
    "notification_id": "fe078e53-78da-4a83-aa89-e7ded5c456e6",
08
    "billing_address": {
09
        "email_address": "john.doe@example.com",
10
        "phone_number": "0723xxxxxx",
11
        "country_code": "KE",
12
        "first_name": "John",
13
        "middle_name": "",
14
        "last_name": "Doe",
15
        "line_1": "Pesapal Limited",
16
        "line_2": "",
17
        "city": "",
18
        "state": "",
19
        "postal_code": "",
20
        "zip_code": ""
21
    },
22
    "account_number": "555-678",
23
    "subscription_details": {
24
        "start_date": "24-01-2023",
25
        "end_date": "31-12-2023",
26
        "frequency": "DAILY"
27
    }
28
}   
After successfully processing your request using the SubmitOrderRequest endpoint, the customer will be shown an option to opt into the recurring model on the Pesapal iframe during payment. The iframe will this time load without he options to re-select the Frequecy, period and dates.

Pesapal Recurring Form

Can a customer opt out of recurring payments before the end date?
Yes, customers have the right to cancel their subscription at anytime. Pesapal will send them email alerts a day or two prior to charging their cards. This ensures customers are always aware of all upcoming charges giving them the freedom to opt out or pausing their subscriptions.

Which cards are currently supported?
We currently support Visa and MasterCard for recurring payments. More card options will be enabled in the near future.

How will Pesapal alert my business about successful recurring payments?
Once a schedule is created and executed successfully, Pesapal will trigger an IPN (Instant Payment Notification) to the IPN endpoint you provided when calling the SubmitOrderRequest endpoint. This IPN call will have the OrderNotificationTypei> set as RECURRING.

Sample IPN URL: https://www.myapplication.com/response-page?OrderTrackingId=b945e4af-80a5-4ec1-8706-e03f8332fb04&OrderMerchantReference=555-678&OrderNotificationType=RECURRING

Recurring IPN Details
The IPN alert will either be a GET or POST request, depending on which HTTP method you selected when registering the IPN URL. Click here for more details on how to register your IPN endpoint.

The IPN call will have the following parameters;

Parameter	Type	Description
OrderTrackingId	String	Unique order id generated by Pesapal.
OrderNotificationType	String	Value set as RECURRING to represent a Recurring IPN call.
OrderMerchantReference	String	Your account number received as part of the SUBMIT ORDER REQUEST.

The IPN call will NOT have all details of the payment for security reasons. As such, you will be required to fetch the payment using the GetTransactionStatus API once the IPN URL is triggered.
In addition to the normal payment status details received from the GetTransactionStatus endpoint, Pesapal will append an object subscription_transaction_info containing some additional recurring payment data

Recurring Payments Extra Data (subscription_transaction_info)

Name	Description
account_reference	Customer's identification number know to your system. This can be an invoice number or an account number.
amount	Amount paid by the customer.
first_name	Customer's first name.
last_name	Customer's last name.
correlation_id	Pesapal's unique recurring payment identifier / id.

Sample Response
01
{
02
    "payment_method": "Visa",
03
    "amount": 100,
04
    "created_date": "2022-04-30T07:41:09.763",
05
    "confirmation_code": "6513008693186320103009",
06
    "payment_status_description": "Failed",
07
    "description": "Unable to Authorize Transaction.Kindly contact your bank for assistance",
08
    "message": "Request processed successfully",
09
    "payment_account": "476173**0010",
10
    "call_back_url": "https://test.com/?OrderTrackingId=7e6b62d9-883e-440f-a63e-e1105bbfadc3&OrderMerchantReference=555-678",
11
    "status_code": 2,
12
    "merchant_reference": "1515111111",
13
    "payment_status_code": "",
14
    "currency": "KES",
15
    "subscription_transaction_info": {
16
        "account_reference": "555-678",
17
        "amount": 100,
18
        "first_name": "John",
19
        "last_name": "Doe",
20
        "correlation_id": 111222
21
    },
22
    "error": {
23
        "error_type": null,
24
        "code": null,
25
        "message": null,
26
        "call_back_url": null
27
    },
28
    "status": "200"
29
}   
What Next?
Once you've fetched the recurring data, you are then required to store the same in your system and provide services / goods as subscribed.

Your IPN endpoint should then respond to Pesapal with a json string confirming service delivery. Part of the json string contains a status parameter that should be set as 200 (meaning request was received and processed) or 500 (meaning request was received but there was an issue providing the services).

Sample JSON Response String: {"orderNotificationType":"RECURRING","orderTrackingId":"d0fa69d6-f3cd-433b-858e-df86555b86c8","orderMerchantReference":"555-678","status":200}

NB: Constant complains from your customers about service / goods not delivered which were paid using recurring / subscription based payment mode will lead to the subscriptions being terminated and your profile banned from using the feature.

Refund Request
Definitions
The refund request endpoint allow you to refund a charge that has previously been processed but not yet refunded. Funds will be refunded to the credit / debit card or mobile money wallet that was originally charged.

The ability to process a refund has the following limitations:

A refund has to be approved by the merchant.
You can't refund more than what was originally collected.
You can only refund payments with the status of COMPLETED.
You can partially or fully refund a payment card payment.
You can only fully refund a payment mobile payment.
Refunds are performed in the currency of the original payment.
Multiple refunds are not allowed. You can only request one refund against a payment.
The URL to our RequestRefund API is either:

Sandbox/Demo URL: https://cybqa.pesapal.com/pesapalv3/api/Transactions/RefundRequest
Production/Live URL: https://pay.pesapal.com/v3/api/Transactions/RefundRequest
Authentication
Bearer Token : Use token generated during authentication.

HTTP request headers
Accept: The response format, which is required for operations with a response body.
Content-Type: The request format, which is required for operations with a request body.

Parameter	Required	Description
Accept	Required	Should be set to application/json
Content-Type	Required	Should be set to application/json

Request Parameters

Parameter	Type	Required	Description
confirmation_code	String	Required	This refers to payment confirmation code that was returned by the processor
amount	Float	Required	Amount to be refunded.
username	String	Required	Identity of the user who has initiated the refund.
remarks	String	Required	A brief description on the reason for the refund.
Sample Request
1
{
2
    "confirmation_code": "AA11BB22",
3
    "amount": "100.00",
4
    "username": "John Doe",
5
    "remarks": "Service not offered"
6
}   
After successfully placing a refund request, a request will be sent to our finance team to start processing the refund.

Response Parameters

Name	Type	Description
error	Integer	200 - Refund received successfully and is being processed. 500 - Refund rejected.
message	String	A brief summary of the response received.
Status 200 mean your request to process the refund has been received successfully. However, please note that this does not mean the refund has been effected. Pesapal has to get the go ahead from the merchant before finalising the refund.

Status 500 mean your request to process the refund was rejected for one reason or another. Refer to the error message for more details.

Sample Response
1
{
2
    "status": "200",
3
    "message": "Refund request successfully"
4
} 
The refund API uses the confirm code for identification. It's important that you store all payment confirmation codes as returned in the Get Transaction Status Endpoint

Order Cancellation API
Definitions
The Order Cancellation API enables you to revoke a previously placed order request that remains incomplete on our end. This API facilitates the cancellation of orders that have encountered failures or are pending transactions.

However, there are certain constraints associated with cancelling a prior request:

Cancellation is exclusively supported for failed or pending payments.
A cancellation request can only be submitted once.
Cancellation is not allowed for payments that have already been processed.
You can access our Cancel Order API via the endpoints provided below:

Sandbox/Demo URL: https://cybqa.pesapal.com/pesapalv3/api/Transactions/CancelOrder
Production/Live URL:https://pay.pesapal.com/v3/api/Transactions/CancelOrder
Authentication
Bearer Token :Use token generated during authentication.

HTTP request headers
Accept: The response format, which is required for operations with a response body.
Content-Type: The request format, which is required for operations with a request body.

Parameter	Required	Description
Accept	Required	Should be set to application/json
Content-Type	Required	Should be set to application/json

Request Parameters

Parameter	Type	Required	Description
order_tracking_id	Guid	Required	This refers to the original Pesapal Order tracking ID that was returned after submitting your order request earlier during the initial submit order request api call.
Sample Request
1
{
2
    "order_tracking_id": "xxxxxxxxxxxxxxxxxxxxxxx"
3
}   
After successfully cancelling the request, the order shall be cancelled on our systems preventing a customer from making further payments to an already cancelled order.

Response Parameters

Name	Type	Description
status	message	200 – Order Successfully cancelled. 500 – Order could not be cancelled.
message	String	A summary of the response received.

Status 200 mean your request to cancel the order has been processed successfully.

Status 500 mean your request to cancel your order has failed due to one or more reasons as shared earlier on the introduction page above.

Sample Response
1
{
2
    "status": "200",
3
    "message": "Order successfully cancelled."
4
} 
The Order Cancellation API uses the Pesapal Order Tracking ID to cancel the order. It's important that you store the Pesapal Order Tracking ID that is sent back to your system during your initial order placement stage i.e. on the submit order request endpoint.
